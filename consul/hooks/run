#!/bin/sh

exec 2>&1

SERVERMODE=$(echo {{cfg.appmode}} | tr '[:upper]' '[:lower]')
echo "Starting in $SERVERMODE mode."
export CONSUL_UI_LEGACY={{cfg.server.legacy_ui}}
CONSUL_OPTS=$(case $SERVERMODE in
  "dev") echo "-dev -bind {{sys.ip}}" ;;
  "server") echo "{{~#if cfg.website}} -ui {{~/if}} -server -bootstrap-expect {{cfg.bootstrap.expect}} -config-file={{pkg.svc_config_path}}/basic_config.json" ;;
  "client") echo "-config-file={{pkg.svc_config_path}}/basic_config.json" ;;
esac)

exec consul agent ${CONSUL_OPTS}
